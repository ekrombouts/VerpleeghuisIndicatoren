---
title: "Working"
author: "Eva Rombouts"
date: "2022-09-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r sourcen laden en packages, include=FALSE}
source ('LadenEnOpschonen.R')
source ('Decubitus.R')

# install.packages("naniar")
library(naniar)
# install.packages("mice")
library(mice)
# install.packages("naniar")
library(naniar)

rm (df, dfact, cbs_postcode)
```

Vul decubitustabel aan met lokatiegegevens en organisatie_ID
```{r aanvullen met lokatiegegevens, echo=FALSE}
LocDec <- decubitus %>%
  left_join(
    select(
      lokaties,
      lokatie_ID,
      locatie,
      nafdelingen,
      nclienten,
      fstedelijk,
      organisatie_ID
    ),
    by = 'lokatie_ID'
  ) %>%
  select (13, 1, 9:12, 2, 8, 3:7) %>%
  rename (ogekozen = opmerking_gekozen,
          operc = opmerking_percentage)

head(LocDec, 2)
# names(LocDec)

```

Bestudeer gekozen. Wordt de beslissing op lokatie of organisatieniveau genomen?
```{r keuze org of loc?, echo=FALSE}
aap <- LocDec %>%
  group_by(organisatie_ID, gekozen) %>%
  summarise(n = n()) %>%
  pivot_wider(names_from = gekozen,
              values_from = n,
              names_prefix = "g") %>%
  mutate (gTRUE = !is.na(gTRUE),
          gFALSE = !is.na(gFALSE)) %>%
  group_by(gTRUE, gFALSE) %>%
  summarise((n = n()))
print (aap)
rm (aap)
# --> Op organisatieniveau. Slechts 22 van de 495 organisaties hebben voor
# sommige lokaties wel en voor andere lokaties niet gekozen voor decubitus,
# 239 hebben wel gekozen, 234 niet.

```

Bestudeer het verschil tussen lokaties die wel of niet voor decubitus 
hebben gekozen.  
In: aantal afdelingen of aantal clienten.  
(NB: analyse op lokatieniveau, terwijl organisatie beslist... korrel zout dus)
```{r wel/geen decubitus per lokatie, echo=FALSE}

# In getallen
LocDec %>%
  group_by(gekozen) %>%
  summarise (
    n = n(),
    mean_nAfd = mean (nafdelingen, na.rm = TRUE),
    med_nAfd = median (nafdelingen, na.rm = TRUE),
    mean_nCl = mean (nclienten, na.rm = TRUE),
    med_nCl = median (nclienten, na.rm = TRUE),
    lmean_nAfd = mean (log(nafdelingen), na.rm = TRUE),
    lmed_nAfd = median (log(nafdelingen), na.rm = TRUE),
    lmean_nCl = mean (log(nclienten), na.rm = TRUE),
    lmed_nCl = median (log(nclienten), na.rm = TRUE)
  )

# In plaatjes
LocDec %>%
  ggplot(aes(gekozen, nafdelingen)) +
  geom_boxplot() +
  stat_summary(fun.y = "mean")

LocDec %>%
  ggplot (aes(gekozen, nclienten)) +
  geom_boxplot() +
  stat_summary(fun.y = "mean")

LocDec %>%
  mutate(nclienten = log(nclienten)) %>%
  ggplot (aes(nclienten,
              color = gekozen)) +
  geom_density()

# base-R
boxplot(nafdelingen ~ gekozen, data = LocDec,
        col = 'bisque')

# t-test
LocDec %>%
  filter (gekozen == "TRUE") %>%
  select (nclienten) %>%
  mutate (nclienten = log (nclienten)) %>%
  t.test (mu = 3.75)

```

Bestudeer missing values
```{r missings}
LocDec %>% 
  filter(complete.cases(.))

LocDec %>% 
  select (-ogekozen, -operc) %>% 
  arrange(organisatie_ID,lokatie_ID) %>% 
  md.pattern()

vis_miss(LocDec)
```

